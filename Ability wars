local ReplicatedStorage = game:GetService("ReplicatedStorage")
local PunchEvent = ReplicatedStorage:FindFirstChild("Remote Events") and ReplicatedStorage:FindFirstChild("Remote Events"):FindFirstChild("Punch")

if not PunchEvent then
    warn("Punch RemoteEvent not found in ReplicatedStorage!")
    return
end

local localPlayer = game.Players.LocalPlayer
local localCharacter = localPlayer.Character or localPlayer.CharacterAdded:Wait()
local localHumanoidRootPart = localCharacter:FindFirstChild("HumanoidRootPart")

local function isNear(targetCharacter, maxDistance)
    if not targetCharacter or not targetCharacter:FindFirstChild("HumanoidRootPart") or not localHumanoidRootPart then
        return false
    end

    local targetRootPart = targetCharacter:FindFirstChild("HumanoidRootPart")
    local distance = (localHumanoidRootPart.Position - targetRootPart.Position).Magnitude
    return distance <= maxDistance
end

local maxDistance = 40
local waitTime = 0.3

while true do
    -- Check if the character has changed (player died/respawned)
    if localPlayer.Character ~= localCharacter then
        localCharacter = localPlayer.Character
        if localCharacter then -- Check if the character exists
            localHumanoidRootPart = localCharacter:FindFirstChild("HumanoidRootPart")
        else
            localHumanoidRootPart = nil -- Reset HRP if character is nil
        end
    end


    if localHumanoidRootPart then -- Only proceed if localHRP is valid
        for _, player in pairs(game:GetService("Players"):GetPlayers()) do
            if player ~= localPlayer and player.Character then
                local character = player.Character
                if isNear(character, maxDistance) then
                    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                    if humanoidRootPart then
                        local args = {
                            [1] = character,
                            [2] = Vector3.new(-132.09571838378906, 25.948652267456055, -5.953305244445801),
                            [3] = 11.787515640258789,
                            [4] = humanoidRootPart
                        }

                        PunchEvent:FireServer(unpack(args))
                    end
                end
            end
        end
    end

    wait(waitTime)
end

